@page "/"
@using Console_UserInterface.Location;
@using static Console_UserInterface.Location.LocationDbContext;
@inject IServiceProvider provider
@inject SigninUser signin
@inject RouteService route
@inject PageService page
@inject LocationService location
@code
{
    public List<object> Routes { get; set; }
    protected override async Task OnInitializedAsync()
    {
        await base.OnInitializedAsync();
        this.Routes = new LocationDbContext().AppRoutes.ToList().Select(r => r.Uri).ToList().Select(p => (object)p).ToList();
        var builder = new MainMenuBuilder.MenuBuilder();
        var fileMenu = builder.CreateMenu("File", new List<string>() { "Create", "Open", "Close" }.Select(text => builder.CreateButtonMenu(text)).ToArray());
        MainMenuModel.Add(fileMenu);
        InitPage();
    }

    void InitPage()
    {
        this.Page = new AppPage();
        foreach (var type in InputTypes.GetAll())
        {
            Page.PageComponents.Add(new PageComponent()
            {
                    Type = type,
                    Name = type,
                    Label = type,
                    Icon = "home",
                    Attributes = new Dictionary<string, string>(),
                    Help = "help",
                    Description = type,
                    Edited = true,
                    IsPrimitive = true,//type != InputTypes.StructureCollection && type != InputTypes.Custom,
                    IsCollection = type == InputTypes.PrimitiveCollection || type == InputTypes.StructureCollection,
                    CollectionSetup = type == InputTypes.PrimitiveCollection || type == InputTypes.StructureCollection ? new PageComponent.CollectionSettings()
                    {
                        ItemType = "DateTime"
                    }: null 
            });
        }
    }
    public List<MainMenuBuilder.MenuItemModel> MainMenuModel { get; set; } = new();
    public object ToolsBarModel { get; set; }
    public TabsContainer Tabs { get; set; }
    public AppPage Page { get; set; }
}

<CardContainer Width="512px" Height="512px">
    <CardHeader>
        <MenuBar Model="MainMenuModel"></MenuBar>
        <ToolsBar Model="ToolsBarModel"></ToolsBar>
        <SearchPane OnSearchSubmit="((SearchPane evt) => { 
            this.Page = location.Navigate(evt.SearchQuery);
        })">
        </SearchPane>
    </CardHeader>
    <CardBody>
        @if (Page is not null)
        {
            <PageView Model="Page"></PageView>
        }
        <TabsContainer @ref="Tabs">
            <ListPrimitiveEditor                                 
                ItemType="@typeof(String)"
                OnAdd="(evt => { route.AddRoute<AppPage>(evt.ToString()); StateHasChanged(); } )"
                Attributes="new Dictionary<string, string>()" 
                Items="@Routes" >
            </ListPrimitiveEditor>
        </TabsContainer>
    </CardBody>
    <CardFooter>
        <StatusBar StatusName="@StatusName" IsActive="@IsActive" ></StatusBar>
    </CardFooter>
</CardContainer>
 @code
{
    public bool IsActive { get; set; }
    public string StatusName { get; set; } = "waiting";
 }