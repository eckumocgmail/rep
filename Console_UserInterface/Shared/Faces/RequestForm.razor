@page "/forms/{Controller}/{Action}"
@using System.Text;
@inherits BaseComponent
@inject IHttpContextAccessor accessor
<FormModel Form="Model" OnReady="OnReady"></FormModel>
@code 
{
    [Parameter]
    [NotNullNotEmpty]
    public string Controller { get; set; }
    [Parameter]
    [NotNullNotEmpty]
    public string Action { get; set; }
    public InputFormModel Model { get; set; }

    protected override async Task OnInitializedAsync()
    {
        await base.OnInitializedAsync();
        this.EnsureIsValide();
        var filePath = Path.Combine
        (
            System.IO.Directory.GetCurrentDirectory(),
            Path.Combine("Forms",$"{Controller}.{Action}.input")
        );
        if (System.IO.File.Exists(filePath)==false)
        {
            throw new Exception($"Не найден файл {filePath}");
        }
        else
        {
            var json = System.IO.File.ReadAllText(filePath);
            this.Model = json.FromJson<InputFormModel>();
            this.Model.Item = this.Model.ItemType.New(); //this.Model.Json is not null ? this.Model.Json.FromJson<object>() : this.Model.ItemType.New();
        }        
    }

    public void OnReady(object evt)
    {
        this.Info(evt.ToJsonOnScreen());
    }
}
